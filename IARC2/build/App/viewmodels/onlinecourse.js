define(["services/utilities","services/httpService","services/displayService"],function(e,t){var n,a,r=require("viewmodels/shell"),o=ko.observable(),g=ko.observable(),l=ko.observable(),i=ko.observable(),s=ko.observable(),d=ko.observable(),p=ko.observable(),m=ko.observable(),c=ko.observable("m"),L=ko.observable(),h=ko.observable(),w=ko.observable(),u=ko.observable(),v=ko.observable(),f=ko.observable(),b=ko.observable(),y=ko.observable(),_=ko.observable(),x=ko.observable(),S=function(){$("#registration-form").parsley().reset(),o(""),g(""),l(""),i(""),s(""),d(""),p(""),m(""),c("m"),L(""),h(""),w(""),u(""),v(""),f(""),b(""),y(""),_(""),n.removeCurrent()},k=ko.asyncCommand({execute:function(r){if($("#registration-form").parsley().validate(),$("#registration-form").parsley().isValid())if(n.getQueueSize()>0)n.submit();else if(a.getQueueSize()>0)a.submit();else{var _={info:{firstname:o(),lastname:g(),efirstname:l(),elastname:i(),email:s(),birthdate:d(),id:p(),country:m(),gender:c(),city:L(),address:h(),house:w(),zip:u(),phone:v(),mobile:f(),reason:b(),cv:y(),timestamp:Date.now(),filename:""}};t.post("Server/register_online_course.php",_).done(function(e){alert("OK! "+e),S(),r(!0)}).error(function(){alert("Oops, an error has occured"),e.handleError(),r(!0)})}else r(!0)},canExecute:function(){return!0}});this.safe_tags=function(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};var C=function(){$("#mobile").tooltip(),$("#phone").tooltip(),$("#id").tooltip()},A={activate:function(){r.selectedSubMenu("onlinecourse"),r.selectedMainMenu("aguda"),ko.bindingHandlers.datetimepicker={init:function(e,t){$(e).datetimepicker({format:"dd/MM/yyyy HH:mm:ss PP",language:"en",pick12HourFormat:!0}).on("changeDate",function(e){var n=t();n(e.date)})},update:function(e,t){var n=ko.utils.unwrapObservable(t());$(e).datetimepicker("setValue",n)}}},compositionComplete:function(){C(),$("#birthdate").datetimepicker({pickTime:!1}),$("#birthdate").on("dp.change",function(e){d(moment(e.date).format("DD-MM-YYYY"))}),$("#firstname").focus();var r=document.getElementById("upload-btn"),k=document.getElementById("payment-btn"),A=document.getElementById("pic-progress-wrap"),B=(document.getElementById("picbox"),document.getElementById("errormsg"));n=new ss.SimpleUpload({button:r,url:"Server/uploadHandler.php?dir=img",name:"uploadfile",multiple:!1,queue:!1,maxUploads:1,maxSize:600,accept:"image/*",hoverClass:"btn-hover",focusClass:"active",disabledClass:"disabled",responseType:"json",autoSubmit:!1,onChange:function(e){_(e)},onExtError:function(e){alert(e+" is not a permitted file type."+"\n\n"+"Only PNG, JPG, and GIF files are allowed.")},onSizeError:function(e){alert(e+" is too big. (600K max file size)")},onSubmit:function(e){var t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div");t.className="prog",r.className="size",n.className="progress progress-striped active",a.className="progress-bar progress-bar-success",n.appendChild(a),t.innerHTML='<span style="vertical-align:middle;">'+safe_tags(e)+" - </span>",t.appendChild(r),t.appendChild(n),A.appendChild(t),this.setProgressBar(a),this.setProgressContainer(t),this.setFileSizeBox(r),B.innerHTML=""},startXHR:function(){var e=document.createElement("button");A.appendChild(e),e.className="btn btn-sm btn-info",e.innerHTML="Cancel",this.setAbortBtn(e,!0)},onComplete:function(n,r){if(_(r.file),a.getQueueSize()>0)a.submit();else{var k={info:{firstname:o(),lastname:g(),efirstname:l(),elastname:i(),email:s(),birthdate:d(),id:p(),country:m(),gender:c(),city:L(),address:h(),house:w(),zip:u(),phone:v(),mobile:f(),reason:b(),cv:y(),timestamp:r.timestamp,filename:_,paymentfilename:x}};t.post("Server/register_online_course.php",k).done(function(e){alert("Very well! "+e),S()}).error(function(){e.handleError()})}}}),a=new ss.SimpleUpload({button:k,url:"Server/uploadHandler.php?dir=payment",name:"uploadfile",multiple:!1,queue:!1,maxUploads:1,maxSize:600,accept:"image/*",hoverClass:"btn-hover",focusClass:"active",disabledClass:"disabled",responseType:"json",autoSubmit:!1,onChange:function(e){x(e)},onExtError:function(e){alert(e+" is not a permitted file type."+"\n\n"+"Only PNG, JPG, and GIF files are allowed.")},onSizeError:function(e){alert(e+" is too big. (600K max file size)")},onSubmit:function(e){var t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div");t.className="prog",r.className="size",n.className="progress progress-striped active",a.className="progress-bar progress-bar-success",n.appendChild(a),t.innerHTML='<span style="vertical-align:middle;">'+safe_tags(e)+" - </span>",t.appendChild(r),t.appendChild(n),A.appendChild(t),this.setProgressBar(a),this.setProgressContainer(t),this.setFileSizeBox(r),B.innerHTML=""},startXHR:function(){var e=document.createElement("button");A.appendChild(e),e.className="btn btn-sm btn-info",e.innerHTML="Cancel",this.setAbortBtn(e,!0)},onComplete:function(n,a){if(!a)return B.innerHTML="Unable to upload file",void 0;if(a.success===!0){x(a.file);var r={info:{firstname:o(),lastname:g(),efirstname:l(),elastname:i(),email:s(),birthdate:d(),id:p(),country:m(),gender:c(),city:L(),address:h(),house:w(),zip:u(),phone:v(),mobile:f(),reason:b(),cv:y(),timestamp:a.timestamp,filename:_,paymentfilename:x}};t.post("Server/register_online_course.php",r).done(function(e){alert("Very well! "+e),S()}).error(function(){e.handleError()})}else B.innerHTML=a.msg?a.msg:"Unable to upload file"}})},firstname:o,lastname:g,efirstname:l,elastname:i,email:s,birthdate:d,id:p,country:m,gender:c,city:L,address:h,house:w,zip:u,phone:v,mobile:f,reason:b,cv:y,file:_,paymentfile:x,Clear:S,Send:k,uploader:n,uploader2:a};return A});