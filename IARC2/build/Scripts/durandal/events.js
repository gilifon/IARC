define(["durandal/system"],function(e){var t=/\s+/,n=function(){},a=function(e,t){this.owner=e,this.events=t};return a.prototype.then=function(e,t){return this.callback=e||this.callback,this.context=t||this.context,this.callback?(this.owner.on(this.events,this.callback,this.context),this):this},a.prototype.on=a.prototype.then,a.prototype.off=function(){return this.owner.off(this.events,this.callback,this.context),this},n.prototype.on=function(e,n,r){var o,g,l;if(n){for(o=this.callbacks||(this.callbacks={}),e=e.split(t);g=e.shift();)l=o[g]||(o[g]=[]),l.push(n,r);return this}return new a(this,e)},n.prototype.off=function(n,a,r){var o,g,l,i;if(!(g=this.callbacks))return this;if(!(n||a||r))return delete this.callbacks,this;for(n=n?n.split(t):e.keys(g);o=n.shift();)if((l=g[o])&&(a||r))for(i=l.length-2;i>=0;i-=2)a&&l[i]!==a||r&&l[i+1]!==r||l.splice(i,2);else delete g[o];return this},n.prototype.trigger=function(e){var n,a,r,o,g,l,i,s;if(!(a=this.callbacks))return this;for(s=[],e=e.split(t),o=1,g=arguments.length;g>o;o++)s[o-1]=arguments[o];for(;n=e.shift();){if((i=a.all)&&(i=i.slice()),(r=a[n])&&(r=r.slice()),r)for(o=0,g=r.length;g>o;o+=2)r[o].apply(r[o+1]||this,s);if(i)for(l=[n].concat(s),o=0,g=i.length;g>o;o+=2)i[o].apply(i[o+1]||this,l)}return this},n.prototype.proxy=function(e){var t=this;return function(n){t.trigger(e,n)}},n.includeIn=function(e){e.on=n.prototype.on,e.off=n.prototype.off,e.trigger=n.prototype.trigger,e.proxy=n.prototype.proxy},n});