define(["durandal/system","durandal/viewEngine"],function(e,t){function n(e,t){for(var n=0;n<e.length;n++){var a=e[n],r=a.getAttribute("data-view");if(r==t)return a}}function a(e){return(e+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")}return{useConvention:function(e,t,n){e=e||"viewmodels",t=t||"views",n=n||t;var r=new RegExp(a(e),"gi");this.convertModuleIdToViewId=function(e){return e.replace(r,t)},this.translateViewIdToArea=function(e,t){return t&&"partial"!=t?n+"/"+t+"/"+e:n+"/"+e}},locateViewForObject:function(t,n,a){var r;if(t.getView&&(r=t.getView()))return this.locateView(r,n,a);if(t.viewUrl)return this.locateView(t.viewUrl,n,a);var o=e.getModuleId(t);return o?this.locateView(this.convertModuleIdToViewId(o),n,a):this.locateView(this.determineFallbackViewId(t),n,a)},convertModuleIdToViewId:function(e){return e},determineFallbackViewId:function(e){var t=/function (.{1,})\(/,n=t.exec(e.constructor.toString()),a=n&&n.length>1?n[1]:"";return"views/"+a},translateViewIdToArea:function(e){return e},locateView:function(a,r,o){if("string"==typeof a){var l;if(l=t.isViewUrl(a)?t.convertViewUrlToViewId(a):a,r&&(l=this.translateViewIdToArea(l,r)),o){var g=n(o,l);if(g)return e.defer(function(e){e.resolve(g)}).promise()}return t.createView(l)}return e.defer(function(e){e.resolve(a)}).promise()}}});